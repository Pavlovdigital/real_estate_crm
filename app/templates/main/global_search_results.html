{% extends "base.html" %}
{% from "_form_helpers.html" import render_field %}

{% block content %}
<div class="container mt-4">
    <h2>Результаты поиска по запросу: "{{ search_query }}"</h2>

    {% include '_flash_messages.html' %}

    {% if not property_results and not client_results %}
        <div class="alert alert-info mt-3">
            По вашему запросу ничего не найдено. Попробуйте другой запрос.
        </div>
    {% endif %}

    {% if property_results %}
        <h4 class="mt-4">Найденные объекты недвижимости ({{ property_results|length }})</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Название</th>
                        <th>Адрес</th>
                        <th>Район</th>
                        <th class="text-end">Цена (тг)</th>
                        <th class="text-end">Площадь (м²)</th>
                        <th class="text-end">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prop in property_results %}
                    <tr>
                        <td>{{ prop.id }}</td>
                        <td><a href="{{ url_for('view_property', property_id=prop.id) }}">{{ prop.name }}</a></td>
                        <td>{{ prop.address if prop.address else '-' }}</td>
                        <td>{{ prop.district if prop.district else '-' }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(prop.price).replace(",", " ") if prop.price else '-' }}</td>
                        <td class="text-end">{{ prop.area if prop.area else '-' }}</td>
                        <td class="text-end">
                            <a href="{{ url_for('view_property', property_id=prop.id) }}" class="btn btn-xs btn-outline-info" title="Обзор"><i class="bi bi-eye"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    {% if client_results %}
        <h4 class="mt-4">Найденные клиенты ({{ client_results|length }})</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Имя</th>
                        <th>Телефон</th>
                        <th>Email</th>
                        <th>Заметки</th>
                        <th class="text-end">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in client_results %}
                    <tr>
                        <td>{{ client.id }}</td>
                        <td><a href="{{ url_for('client.edit_client', client_id=client.id) }}">{{ client.name }}</a></td>
                        <td>{{ client.phone if client.phone else '-' }}</td>
                        <td>{{ client.email if client.email else '-' }}</td>
                        <td>{{ client.notes[:50] if client.notes else '-' }}{% if client.notes and client.notes|length > 50 %}...{% endif %}</td>
                        <td class="text-end">
                             <a href="{{ url_for('client.edit_client', client_id=client.id) }}" class="btn btn-xs btn-outline-primary" title="Редактировать"><i class="bi bi-pencil"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    {# Add deal_results section here if implemented in the route #}

</div>
{% endblock %}
