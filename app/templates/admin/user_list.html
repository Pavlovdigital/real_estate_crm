{% extends "base.html" %}
{% from "_form_helpers.html" import render_field %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>{{ title }}</h2>
        {# Optional: Add button to create new user via admin interface if needed in future #}
        {# <a href="{{ url_for('admin.create_user_admin') }}" class="btn btn-success"><i class="bi bi-person-plus-fill"></i> Создать пользователя</a> #}
    </div>

    {% include '_flash_messages.html' %}

    {% if users %}
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Имя пользователя</th>
                    <th>Email</th>
                    <th>Роль</th>
                    <th>Дата регистрации</th>
                    <th class="text-end">Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for user_item in users %}
                <tr>
                    <td>{{ user_item.id }}</td>
                    <td>{{ user_item.username }}</td>
                    <td>{{ user_item.email }}</td>
                    <td><span class="badge {% if user_item.role and user_item.role.name == 'Admin' %}bg-danger{% elif user_item.role and user_item.role.name == 'Agent' %}bg-warning text-dark{% else %}bg-secondary{% endif %}">{{ user_item.role.name if user_item.role else 'Нет роли' }}</span></td>
                    {# Assuming User model has created_at, if not, this might error or be blank #}
                    <td>{{ user_item.created_at.strftime('%d.%m.%Y %H:%M') if user_item.created_at else '-'}}</td> 
                    <td class="text-end">
                        <a href="{{ url_for('admin.edit_user', user_id=user_item.id) }}" class="btn btn-xs btn-outline-primary" title="Редактировать"><i class="bi bi-pencil-square"></i></a>
                        {# Optional: Delete user button can be added here later #}
                        {# 
                        <form action="{{ url_for('admin.delete_user_placeholder', user_id=user_item.id) }}" method="POST" class="d-inline ms-1">
                            <button type="submit" class="btn btn-xs btn-outline-danger" title="Удалить" onclick="return confirm('Вы уверены, что хотите удалить пользователя {{ user_item.username|e }}? Это действие необратимо.');"><i class="bi bi-trash-fill"></i></button>
                        </form> 
                        #}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">
       Пользователи не найдены.
    </div>
    {% endif %}
</div>
{% endblock %}
